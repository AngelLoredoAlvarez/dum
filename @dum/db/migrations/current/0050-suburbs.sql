/*
 * Table that will store all the suburbs in a town
 */
create table dum_public.suburbs (
  id uuid primary key default gen_random_uuid(),
  name text,
  town_id uuid not null references dum_public.towns on delete cascade,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

alter table dum_public.suburbs enable row level security;

-- Suburbs are publicly visible.
create policy select_all on dum_public.suburbs for select using (true);

-- Grant SELECT to the :DATABASE_VISITOR role
grant select on dum_public.suburbs to :DATABASE_VISITOR;

-- Allow efficient retrieval of all the Suburbs owned by a particular Town.
create index idx_town_suburbs on dum_public.suburbs(town_id);

comment on table dum_public.suburbs is
  E'A Suburb registered to allow a user to set their addresses.';

comment on column dum_public.suburbs.name is
  E'The name of the suburb.';

create trigger _100_timestamps
  before insert or update on dum_public.suburbs
  for each row
  execute procedure dum_private.tg__timestamps();

/*
 * Custom Query that returns all Suburs in a Specific Town
 */
create or replace function dum_public.suburbs_by_town_id(town_id uuid default null) returns setof dum_public.suburbs as $$
  select * from dum_public.suburbs where dum_public.suburbs.town_id = $1;
$$ language sql stable;

-- Inserts the default suburbs associated to a specific town
insert into dum_public.suburbs(name, town_id) values('CENTRO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('REGULARIZACION  DANIEL DIAZ CORPUS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. TIERRA BLANCA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. VALLE DEL RIO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('REGULARIZACION JULIANA MARGARITA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. EL CAMPANARIO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. CUMBRES DEL VALLE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. RESIDENCIAL DEL RIO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. JARDINES DEL CARMEN RESIDENCIAL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. REAL DEL LLANO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC VALLE DE BRAVO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. RESIDENCIAL LAS ROSAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. LOS FRESNOS II', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. LOS ARCOS RESIDENCIAL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. PUERTA DEL CIELO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. PRADERAS DEL SOL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS NOGALES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. EL INGLES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC SANTA FE II', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. CATALINA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. LA CENICIENTA II', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. NOCHE BUENA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACCIONAMIENTO GARCIA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN FRANCISCO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC SAN ISIDRO II', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LAS TORRES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('JUAREZ', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA BONITA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOMAS DE LOS ANGELES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('HACIENDAS DE SAN ANTONIO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('PRIVADA DEL REAL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN FELIPE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('ASTURIAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS FRESNOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('A. G. G.', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('RESIDENCIAL SANTA MARIA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('NOYOLA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('ROSA BLANCA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS OLIVOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA HACIENDA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SANTA ROSA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('VILLAS DE MARQUEZ', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA JOYA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL GENERAL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN EXPEDITO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN MIGUEL (AHORA VALLE DEL SOL )', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('GIRASOLES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRAILES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOURDES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL MANANTIAL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACCIONAMIENTO FERROCARRILERO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN MARCOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LAS ALAZANAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('BUGAMBILIAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('PRIVADA DEL BOSQUE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LAS ROSAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CONDOMINIO LA LIDIA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('J. H. M. DEL VALLE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS SAUCES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRONTERA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA PASADITA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN ISIDRO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('UNIDAD HABITACIONAL LOS ANGELES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('MILITARES POTOSINOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LAS HUERTAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CENTRAL DE ABASTOS, FRACC LANDAVERDE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('M. D. R.', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('REAL DE PALMAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CENTRAL DE ABASTOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE RAYON DE LOS ANGELES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('VALLE DE LOS ANGELES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN ANGEL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('I.N.G.', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SANTA ISABEL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('M.T.L.', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL PORVENIR', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('DEL SOL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CARRION DE LOS CONDES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('QUINTAS EL NARANJAL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN JOSE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE AGUASCALIENTES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL RODANO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA LUZ', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('VIELMA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA ESPERANZA 2', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('VALLE DE GUADALUPE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('VILLAS ALEJANDRA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('AVENIDA VERASTEGUI', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN ANDRES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE LAZARO CARDENAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN JUAN (CARPETAS 24 Y 31)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE 5 DE FEBRERO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE PABLO VERASTEGUI (CALLE DE COMERCIO)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE RAYON CON ALDAMA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACIONAMIENTO SAN JUAN', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA ESPERANZA 1', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN BERNARDO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('COLONIA GUADALUPANA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA PIEDAD', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN JUAN', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('RIO GRANDE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOTIFICACION EN CALLE BOSQUE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA ILUSION 2', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOURDES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('RESIDENCIAL SAN ISIDRO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('COLONIA VERASTEGUI', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('COLONIA CRISTO REY', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL CHANITO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC. LAS ARBOLEDAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('RESIDENCIAL CENTENARIO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('MOD. HABITACIONAL CARLOS J.B', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL ROCIO (AHORA PRIV. DE HEROES POTOSINOS)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS AZAHARES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS SABINOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('MORELOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS PINOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SANTA MARIA DE GUADALUPE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LEON FRANCO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA CANTERA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL QUESO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('GARZA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('INDEPENDENCIA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('INFONAVIT OJO DE AGUA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('COLONIA UNION', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA QUINTA 2', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SANTA FE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('AZAHARES DE LA UNION', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN RAFAEL 2', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SANTA CATARINA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('MARGARITAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL CARMEN', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('GALEANA (3A PRIVADA DE GALEANA)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL PARAISO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN RAFAEL 1', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('INFONAVIT LOS NARANJOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EBANO (AHORA ASTURIAS)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FLOR DE AZAHAR( QUINTA II)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN JOSE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('PRIVADA DE PONCE (PRIVADA GABRIEL MARTINEZ)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE AURELIO MANRIQUE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CRUZ VERDE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('JARDINES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN RAFAEL 3', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('MIER I TERAN 1', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE LEYES DE REFORMA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA MORITA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('COLONIA VICTORIA 1', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('ZARATE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FLOR DE MAYO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('MATAMOROS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA PURISIMA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN LORENZO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('ISLA SAN PABLO 2', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('ISLA SAN PABLO 3', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA PALMA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('PASO DEL POTRERO 2', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('PRECURSORES', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('COLONIA VICTORIA 2', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRONTERA (LA CORTADURA)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('GALLINAS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('PRIMER PRIVADA DE GAMA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('ISLA DEL REFUGIO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LAS BRISAS DEL NORTE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN VICENTE (CALLE AURELIO MANRIQUEZ)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SANTA JULIA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL CARMEN 2', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('POSADAS N.', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('EL QUESO 2 (1a PRIV. DE PORFIRIO DIAZ)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS ALONSOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('ZARAGOZA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE LOPEZ DEL FRACCIONAMIENTO COMERCIAL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('COLONIA LOS NARANJOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CENTENARIO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('4A. PRIVADA DE GALEANA (NO ESTA EL EXPEDIENTE)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('GRANJAS DEL PUENTE', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('MADERO MARGARITA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('MOLINO COLORADO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('PEDREGAL DE SAN MARCOS', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('QUEZADA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('VILLA DE CHAVEZ (CALLE 16 DE SEPTIEMBRE)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('FRACC CASTILLO (CALLE PONCIANO ARRIAGA)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA PURISIMA (GUADALUPE)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('CALLE FCO. JAVIER MINA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('SAN ANTONIO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS GIRASOLES (CALLE FRONTERA)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('ACCION NACIONAL', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LOS CIPRESES I', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('BARRIO DE LOS ANGELES(CALLE  ZARAGOZA)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA FORTUNA ,( MARIA DE LOS ANGELES)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('PRIVADA DE QUEZADA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('GUADALUPE (5º PRIV. DE GALEANA)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('JUAREZ Y BRAVO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA PEÑITA', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('GAMA Y MIER Y TERAN', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('MOLLINEDO', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('PRIVADA DE QUEZADA(EXP.97)', '84673058-eca2-42b1-bd94-84b1ece47c0c'),
                                                    ('LA QUINTA 2', '84673058-eca2-42b1-bd94-84b1ece47c0c');
